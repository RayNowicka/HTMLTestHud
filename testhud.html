<html>

<head>
    <title>Bot Test Hud!</title>
    <script src="https://code.jquery.com/jquery-3.5.0.js"></script>
    <style>
        body {
            margin: 2rem;
        }
        button {
            display: block;
            margin: 1rem 0rem;
        }
    </style>
    <script>
        // This is where you put your config information
        // Set this to the name of the group.
        group = "My Group";
        // Set this to the group password.
        password = "password";
        // Set this to Corrade's HTTP Server URL.
        botURL = 'http://127.0.0.1:8080';
    </script>
</head>

<body>
    <h1>Bot Test Hud</h1>
    <p>This ia a relatively simple form that uses jQuery that sends a command to a Corrade bot.</p>
    <p><b>Syntax:</b> command=sit&item=chair<br />
        group, password are defined in the html code and 
        are added automatically.<br /></p>
    <!-- This is the form -->
    <form id="botcommand">
        <textarea form="botcommand" id="formtextarea" rows="5" cols="60"></textarea>
        <button id="subBtn">Submit</button>
    </form>

    <!-- This is the script -->
    <script>
        // When you press Enter, stuff happens
        $("#formtextarea").on('keyup', function (e) {
            if (e.key === 'Enter' || e.keyCode === 13) {
                SubmitTheForm(group, password, botURL);
            }
        });

        // When you press the button, stuff happens:
        $('#subBtn').on('click', function () {
            SubmitTheForm(group, password, botURL);
        });

        // This is the stuff that happens...
        function SubmitTheForm(group, password, botURL) {
            botcommand = "tell";
            farts = "local";
            formresult = "{ \"command=tell&message=Hello world!&entity=local\" }";
            formresult = $('#formtextarea').val();
            formresult = formresult.replace(/^\s+|\s+$/g, '');
            formresult = "{ \"" + formresult + "\"}";
            formresult = formresult.replace(/=/g, "\":\"");
            formresult = formresult.replace(/&/g, "\", \"");
            var botcredentials = {
                group: group,
                password: password
            };
            var botcommandoptional = JSON.parse(formresult);

            let botcommandfull = {
                ...botcredentials,
                ...botcommandoptional
            };
            $.post(botURL, botcommandfull,
                function (data) {
                    alert(data);
                }
            );
        }
    </script>
</body>

</html>
